<form>
  <div class="overlay-config-container">
    <div class="overlay-config-header">
      <h2>Configure Active Layout Items</h2>
      <div>
        <label for="active-layout">Select Layout:</label>
        <select id="active-layout" name="activeLayout">
          {{#each layouts}}
            <option value="{{@key}}" {{#ifEquals ../activeLayout @key}}selected{{/ifEquals}}>
              {{@key}} {{#ifEquals ../activeLayout @key}}(Active){{/ifEquals}}
            </option>
          {{/each}}
        </select>
        <button type="button" class="manage-layouts" onclick="new ManageLayouts().render(true)">Manage Layouts</button>
      </div>
    </div>
    
    <div class="overlay-config-items">
      <table style="width: 100%; text-align: left;">
        <thead>
          <tr>
            <th>Type</th>
            <th style="width: 50px;">Order</th>
            <th style="width:20%;">Content</th>
            <th>
              Extra 
              <button type="button" class="toggle-extras-column" title="Toggle Extra Details">
                <i class="fas fa-chevron-down"></i>
              </button>
            </th>
            <th>Animation</th>
            <th>Top (px)</th>
            <th>Left (px)</th>
            <th>Hide</th>
            <th style="width: 50px;">Remove</th>
          </tr>
        </thead>
        <tbody>
          {{#each rows}}
          <tr>
            <input type="hidden" name="type-{{this.idx}}" value="{{this.type}}">
            <td>{{this.type}}</td>
            <td style="width:50px;">
              <button type="button" class="move-up" data-index="{{this.idx}}">↑</button>
              <button type="button" class="move-down" data-index="{{this.idx}}">↓</button>
            </td>
            
            {{#ifEquals this.type "data"}}
            <td>
              Actor:
              <select name="actorId-{{this.idx}}">
                <option value="">(None)</option>
                {{#each ../allActors}}
                  <option value="{{this.id}}" {{#ifEquals this.id ../this.actorId}}selected{{/ifEquals}}>
                    {{this.name}}
                  </option>
                {{/each}}
              </select>
              <br>
              Data Field:
              <select name="dataPath-{{this.idx}}">
                {{#each ../dataPathChoices}}
                  <option value="{{this.path}}" {{#ifEquals this.path ../this.dataPath}}selected{{/ifEquals}}>
                    {{this.label}}
                  </option>
                {{/each}}
              </select>
              <br>
              <label>
                <input type="checkbox" name="addLabel-{{this.idx}}" {{#if this.addLabel}}checked{{/if}}>
                Add Label to Display
              </label>
            </td>
            <td class="extras-column">
              <div class="extras-content">
                Font Size:
                <input type="number" name="fontSize-{{this.idx}}" value="{{this.fontSize}}" style="width:60px;">
                <br>
                Bold:
                <input type="checkbox" name="bold-{{this.idx}}" {{#if this.bold}}checked{{/if}}>
                <br>
                Font:
                <select name="fontFamily-{{this.idx}}">
                  <option value="Arial, sans-serif" {{#ifEquals this.fontFamily "Arial, sans-serif"}}selected{{/ifEquals}}>Arial</option>
                  <!-- Full font list would go here -->
                </select>
                <br>
                Colour:
                <input type="color" name="fontColor-{{this.idx}}" value="{{this.fontColor}}" style="width:80px;">
                
                <hr style="margin: 8px 0;">
                <div style="margin-top: 8px;">
                  <label>
                    <input type="checkbox" name="fontStroke-{{this.idx}}" {{#if this.fontStroke}}checked{{/if}}>
                    Text Outline
                  </label>
                  <div {{#if this.fontStroke}}style="display:block;"{{else}}style="display:none;"{{/if}} class="stroke-options-{{this.idx}}">
                    Outline Color:
                    <input type="color" name="fontStrokeColor-{{this.idx}}" value="{{this.fontStrokeColor}}" style="width:80px;">
                    <br>
                    Outline Width:
                    <input type="number" step="0.5" min="0.5" max="5" name="fontStrokeWidth-{{this.idx}}" value="{{this.fontStrokeWidth}}" style="width:60px;"> px
                  </div>
                </div>
              </div>
            </td>
            {{else ifEquals this.type "static"}}
            <td>
              Static Text:
              <input type="text" name="content-{{this.idx}}" value="{{this.content}}" style="width:100%;">
            </td>
            <td class="extras-column">
              <div class="extras-content">
                Font Size:
                <input type="number" name="fontSize-{{this.idx}}" value="{{this.fontSize}}" style="width:60px;">
                <br>
                Bold:
                <input type="checkbox" name="bold-{{this.idx}}" {{#if this.bold}}checked{{/if}}>
                <br>
                Font:
                <select name="fontFamily-{{this.idx}}">
                  <option value="Arial, sans-serif" {{#ifEquals this.fontFamily "Arial, sans-serif"}}selected{{/ifEquals}}>Arial</option>
                </select>
                <br>
                Colour:
                <input type="color" name="fontColor-{{this.idx}}" value="{{this.fontColor}}" style="width:80px;">
                
                <hr style="margin: 8px 0;">
                <div style="margin-top: 8px;">
                  <label>
                    <input type="checkbox" name="fontStroke-{{this.idx}}" {{#if this.fontStroke}}checked{{/if}}>
                    Text Outline
                  </label>
                  <div {{#if this.fontStroke}}style="display:block;"{{else}}style="display:none;"{{/if}} class="stroke-options-{{this.idx}}">
                    Outline Color:
                    <input type="color" name="fontStrokeColor-{{this.idx}}" value="{{this.fontStrokeColor}}" style="width:80px;">
                    <br>
                    Outline Width:
                    <input type="number" step="0.5" min="0.5" max="5" name="fontStrokeWidth-{{this.idx}}" value="{{this.fontStrokeWidth}}" style="width:60px;"> px
                  </div>
                </div>
              </div>
            </td>
            {{else}}
            <td>
              Image Path:
              <input type="text" name="imagePath-{{this.idx}}" value="{{this.imagePath}}" style="width:100%;" readonly>
              <button type="button" class="file-picker" data-index="{{this.idx}}">Choose</button>
            </td>
            <td class="extras-column">
              <div class="extras-content">
                Size:
                <input type="number" name="imageSize-{{this.idx}}" value="{{this.imageSize}}" style="width:60px;">
              </div>
            </td>
            {{/ifEquals}}
            
            <td>
              <button type="button" class="manage-animations" data-index="{{this.idx}}">
                Manage Animations
                {{#if this.hasAnimations}}
                <span class="animation-indicator"><i class="fas fa-check-circle"></i></span>
                {{/if}}
              </button>
            </td>
            
            <td>
              <input type="number" name="top-{{this.idx}}" value="{{this.top}}" style="width:60px;">
            </td>
            <td>
              <input type="number" name="left-{{this.idx}}" value="{{this.left}}" style="width:60px;">
            </td>
            <td style="text-align:center;">
              <input type="checkbox" name="hide-{{this.idx}}" {{#if this.hide}}checked{{/if}}>
            </td>
            <td style="text-align:center;">
              <button type="button" class="remove-row" data-index="{{this.idx}}">X</button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
    
    <div class="overlay-config-footer">
      <div class="overlay-config-buttons">
        <div class="left-buttons">
          <button type="button" class="add-row">Add Data</button>
          <button type="button" class="add-static">Add Static Text</button>
          <button type="button" class="add-image">Add Image</button>
        </div>
        <div class="right-buttons">
          <button type="button" id="open-overlay-from-config">Open Overlay</button>
        </div>
      </div>
      
      {{#unless isPremium}}
      <div style="text-align: right; margin-top:0.5em; font-size: 0.8em; opacity: 0.8;">
        Made by Jen.
        <a href="https://www.patreon.com/c/jenzelta" target="_blank">Support on Patreon for premium features</a>
      </div>
      {{/unless}}
    </div>
  </div>
</form>

<style>
  .toggle-extras-column {
    background: none;
    border: none;
    cursor: pointer;
    margin-left: 5px;
    padding: 0;
    color: #666;
    transition: color 0.2s;
  }

  .toggle-extras-column:hover {
    color: #333;
  }

  .extras-column {
    vertical-align: top;
  }

  .extras-content {
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
    overflow: hidden;
  }
</style>